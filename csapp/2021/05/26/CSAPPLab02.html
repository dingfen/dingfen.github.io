<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.3 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="zh" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>深入理解计算机系统之二进制炸弹实验 - 峰子的乐园</title>
<meta name="description" content="如何有效提升x86汇编阅读能力和GDB调试器使用能力">


  <meta name="author" content="Bill Ding">


<meta property="og:type" content="article">
<meta property="og:locale" content="zh_CN">
<meta property="og:site_name" content="峰子的乐园">
<meta property="og:title" content="深入理解计算机系统之二进制炸弹实验">
<meta property="og:url" content="https://dingfen.github.io/csapp/2021/05/26/CSAPPLab02.html">


  <meta property="og:description" content="如何有效提升x86汇编阅读能力和GDB调试器使用能力">



  <meta property="og:image" content="https://dingfen.github.io/assets/img/teaser2.jpg">





  <meta property="article:published_time" content="2021-05-26T00:00:00+08:00">





  

  


<link rel="canonical" href="https://dingfen.github.io/csapp/2021/05/26/CSAPPLab02.html">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Bill Ding",
      "url": "https://dingfen.github.io/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="峰子的乐园 Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single categories">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          峰子的乐园
          <span class="site-subtitle">合抱之木，生于毫末；九层之台，起于累土；千里之行，始于足下</span>
        </a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/">Home</a>
            </li>
<li class="masthead__menu-item">
              <a href="/home/about">About</a>
            </li>
<li class="masthead__menu-item">
              <a href="/home/blog">Blogs</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories">Categories</a>
            </li>
<li class="masthead__menu-item">
              <a href="https://google.com">External Link</a>
            </li>
</ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">切换菜单</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  







<div class="page__hero--overlay" style=" background-image: url('/assets/img/teaser2.jpg');">
  
    <div class="wrapper">
      <h1 id="page-title" class="page__title" itemprop="headline">
        
          深入理解计算机系统之二进制炸弹实验

        
      </h1>
      
        <p class="page__lead">如何有效提升x86汇编阅读能力和GDB调试器使用能力
</p>
      
      
        <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  9 minutes read

</p>
      
      
      
    </div>
  
  
</div>





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/img/avatar.jpg" alt="Bill Ding" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Bill Ding</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Programmer, Graduate majored in CS</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Hefei, Anhui, China</span>
        </li>
      

      
        
          
            <li><a href="df12138@mail.ustc.edu.cn" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
            <li><a href="https://github.com/dingfen" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="深入理解计算机系统之二进制炸弹实验">
    <meta itemprop="description" content="如何有效提升x86汇编阅读能力和GDB调试器使用能力">
    <meta itemprop="datePublished" content="2021-05-26T00:00:00+08:00">
    

    <div class="page__inner-wrap">
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> 目录</h4></header>
              <ul class="toc__menu">
  <li>
<a href="#%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E4%BA%8C%E8%BF%9B%E5%88%B6%E7%82%B8%E5%BC%B9%E5%AE%9E%E9%AA%8C">深入理解计算机系统——二进制炸弹实验</a>
    <ul>
      <li><a href="#%E5%AE%9E%E9%AA%8C%E7%AE%80%E4%BB%8B">实验简介</a></li>
      <li><a href="#%E5%AE%9E%E9%AA%8C%E9%A2%84%E5%A4%87">实验预备</a></li>
      <li>
<a href="#%E6%8B%86%E5%BC%B9">拆弹</a>
        <ul>
          <li><a href="#phase_1">phase_1</a></li>
          <li><a href="#phase_2">phase_2</a></li>
          <li><a href="#phase_3">phase_3</a></li>
          <li><a href="#phase_4">phase_4</a></li>
          <li><a href="#phase_5">phase_5</a></li>
          <li><a href="#phase_6">phase_6</a></li>
          <li><a href="#secret_phase">secret_phase</a></li>
        </ul>
      </li>
      <li><a href="#%E6%80%BB%E7%BB%93">总结</a></li>
    </ul>
  </li>
</ul>

            </nav>
          </aside>
        
        <h1 id="深入理解计算机系统二进制炸弹实验">深入理解计算机系统——二进制炸弹实验</h1>

<h2 id="实验简介">实验简介</h2>

<p>二进制炸弹是一个作为目标代码文件的程序。运行时，它提示用户输入若干个不同的字符串。如果其中一个不正确，炸弹就会“爆炸”，打印出一条错误信息。用户必须通过对程序的反汇编和逆向工程来求出这六个字符串，解决这些炸弹。该实验的主要目的是，深入理解汇编语言，并学习使用 gdb 调试器。</p>

<p>在本次实验中，我们需要拆解七个炸弹（其中一个为隐藏炸弹）。</p>

<h2 id="实验预备">实验预备</h2>

<p>下载完实验材料后，有两个文件值得关注：<code class="language-plaintext highlighter-rouge">bomb</code> 和 <code class="language-plaintext highlighter-rouge">bomb.c</code> 。<code class="language-plaintext highlighter-rouge">bomb</code> 就是要“拆解”的目标文件代码，而 <code class="language-plaintext highlighter-rouge">bomb.c</code> 只是辅助理解的部分源代码文件。首先，对 <code class="language-plaintext highlighter-rouge">bomb</code> 进行逆向：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>objdump <span class="nt">-d</span> bomb <span class="o">&gt;&gt;</span> bomb.s
</code></pre></div></div>

<p>得到反汇编文件 <code class="language-plaintext highlighter-rouge">bomb.s</code> ，然后，在该文件中找到相关函数的反汇编代码，开始拆解炸弹！</p>

<h2 id="拆弹">拆弹</h2>

<h3 id="phase_1">phase_1</h3>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">phase_1:</span>
    <span class="nf">push</span>   <span class="o">%</span><span class="nb">ebp</span>
    <span class="nf">mov</span>    <span class="o">%</span><span class="nb">esp</span><span class="p">,</span><span class="o">%</span><span class="nb">ebp</span>
    <span class="nf">sub</span>    <span class="kc">$</span><span class="mh">0x8</span><span class="p">,</span><span class="o">%</span><span class="nb">esp</span>
    <span class="nf">movl</span>   <span class="kc">$</span><span class="mh">0x8049948</span><span class="p">,</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>

    <span class="nf">mov</span>    <span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
    <span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>
    <span class="nf">call</span>    <span class="o">&lt;</span><span class="nv">strings_not_equal</span><span class="o">&gt;</span>
    <span class="nf">test</span>   <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">%</span><span class="nb">eax</span>
    <span class="nf">je</span>     <span class="o">&lt;</span><span class="nv">phase_1</span><span class="o">+</span><span class="mh">0x22</span><span class="o">&gt;</span>
    <span class="nf">call</span>  <span class="o">&lt;</span><span class="nv">explode_bomb</span><span class="o">&gt;</span>
    <span class="nf">leave</span>  
    <span class="nf">ret</span>    
</code></pre></div></div>

<p>比较字符串，若相等就不会爆炸。找到目标字符串。</p>

<p>gdb找到：</p>

<p><img src="/assets/img/CSAPP/lab2/1.png" alt=""></p>

<p>成功！</p>

<p><img src="/assets/img/CSAPP/lab2/1_1.png" alt=""></p>

<h3 id="phase_2">phase_2</h3>

<p>再来看第二个炸弹的反汇编代码。</p>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">phase_2:</span>
    <span class="nf">push</span>   <span class="o">%</span><span class="nb">ebp</span>		<span class="c1">; set up stack size==0x28</span>
    <span class="nf">mov</span>    <span class="o">%</span><span class="nb">esp</span><span class="p">,</span><span class="o">%</span><span class="nb">ebp</span>
    <span class="nf">sub</span>    <span class="kc">$</span><span class="mh">0x28</span><span class="p">,</span><span class="o">%</span><span class="nb">esp</span>
    <span class="nf">lea</span>    <span class="o">-</span><span class="mh">0x1c</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>		<span class="c1">; eax=ebp-0x1c</span>
    <span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>		<span class="c1">; ebp-0x1c=(esp+0x4)</span>
    <span class="nf">mov</span>    <span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>		<span class="c1">; (ebp+0x8)=(esp)</span>
    <span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>
    <span class="nf">call</span>   <span class="o">&lt;</span><span class="nv">read_six_numbers</span><span class="o">&gt;</span>	<span class="c1">; read_six_numbers() needs 2 para</span>
    <span class="nf">movl</span>   <span class="kc">$</span><span class="mh">0x1</span><span class="p">,</span><span class="o">-</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>		<span class="c1">; loop begin i=0x1</span>
    <span class="nf">jmp</span>    <span class="o">&lt;</span><span class="nv">phase_2</span><span class="o">+</span><span class="mh">0x3f</span><span class="o">&gt;</span>
    <span class="nf">mov</span>    <span class="o">-</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>		<span class="c1">; eax=i</span>
    <span class="nf">mov</span>    <span class="o">-</span><span class="mh">0x1c</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">,</span><span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="o">%</span><span class="nb">edx</span>	<span class="c1">;edx=(ebp-0x1c+4*eax)</span>
    <span class="nf">mov</span>    <span class="o">-</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
    <span class="nf">dec</span>    <span class="o">%</span><span class="nb">eax</span>		<span class="c1">; eax=i-1</span>
    <span class="nf">mov</span>    <span class="o">-</span><span class="mh">0x1c</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">,</span><span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>	<span class="c1">; eax=(ebp-0x1c+4*eax)</span>
    <span class="nf">add</span>    <span class="kc">$</span><span class="mh">0x5</span><span class="p">,</span><span class="o">%</span><span class="nb">eax</span>	<span class="c1">; eax+=0x5</span>
    <span class="nf">cmp</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">%</span><span class="nb">edx</span> <span class="c1">; is equal? explode if not</span>
    <span class="nf">je</span>     <span class="o">&lt;</span><span class="nv">phase_2</span><span class="o">+</span><span class="mh">0x3c</span><span class="o">&gt;</span>
    <span class="nf">call</span>  <span class="o">&lt;</span><span class="nv">explode_bomb</span><span class="o">&gt;</span>
    <span class="nf">incl</span>   <span class="o">-</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>	<span class="c1">; (ebp-0x4)++</span>
    <span class="nf">cmpl</span>   <span class="kc">$</span><span class="mh">0x5</span><span class="p">,</span><span class="o">-</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>	<span class="c1">; loop unit i==5</span>
    <span class="nf">jle</span>   <span class="o">&lt;</span><span class="nv">phase_2</span><span class="o">+</span><span class="mh">0x21</span><span class="o">&gt;</span>
    <span class="nf">leave</span>  
    <span class="nf">ret</span>    

</code></pre></div></div>

<p>仔细阅读后发现，程序先调用了 <code class="language-plaintext highlighter-rouge">read_six_numbers</code> 的函数，而在之前，程序准备了一个参数放在 <code class="language-plaintext highlighter-rouge">%esp+4</code> 处，该参数的意义需要进一步阅读下面的代码才能知晓。之后，程序就进入了一个循环，用于不断测试条件，如果条件不符，炸弹就会爆炸！显然，该循环就是关键，这个炸弹就是考验汇编语言的循环部分了。经整理，循环用 C 代码表示如下：</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">*</span><span class="n">a</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">ebp</span><span class="o">-</span><span class="mh">0x1c</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">edx</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="n">eax</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">5</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">eax</span> <span class="o">!=</span> <span class="n">edx</span><span class="p">)</span>
        <span class="n">explode_bomb</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>现在，明白 <code class="language-plaintext highlighter-rouge">read_six_numbers</code> 函数的参数 <code class="language-plaintext highlighter-rouge">ebp-0x1c</code> 是一个数组地址。大致可以猜到，只要输入 6 个数字，相邻两个差为 5 即可拆解炸弹。</p>

<p>等等，并不是任意的差为 5 的等差数列都满足要求！对首项，<code class="language-plaintext highlighter-rouge">read_six_numbers</code> 函数也有要求：</p>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">read_six_numbers:</span>
	<span class="c1">; ....</span>
	<span class="nf">mov</span>    <span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
    <span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>
    <span class="nf">call</span>    <span class="o">&lt;</span><span class="nb">ss</span><span class="nv">canf@plt</span><span class="o">&gt;</span>
    <span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">-</span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
    <span class="nf">cmpl</span>   <span class="kc">$</span><span class="mh">0x5</span><span class="p">,</span><span class="o">-</span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>	<span class="c1">; compare with (ebp-0xc) 5</span>
    <span class="nf">jg</span>      <span class="o">&lt;</span><span class="nv">read_six_numbers</span><span class="o">+</span><span class="mh">0x62</span><span class="o">&gt;</span>
    <span class="nf">call</span>    <span class="o">&lt;</span><span class="nv">explode_bomb</span><span class="o">&gt;</span>
    <span class="nf">add</span>    <span class="kc">$</span><span class="mh">0x30</span><span class="p">,</span><span class="o">%</span><span class="nb">esp</span>
</code></pre></div></div>

<p>看起来，输入的首项必须比 5 大，那么首项就是 6 吧 <img class="emoji" title=":smile:" alt=":smile:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png" height="20" width="20">。</p>

<p>验证一下：</p>

<p><img src="/assets/img/CSAPP/lab2/2.png" alt=""></p>

<h3 id="phase_3">phase_3</h3>

<p>再接再厉，开始拆解第三个炸弹。<code class="language-plaintext highlighter-rouge">phase_3</code> 函数的汇编代码明显长了不少，先看第一部分：</p>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">phase_3:</span>
	<span class="c1">; ...</span>
    <span class="nf">movl</span>   <span class="kc">$</span><span class="mh">0x0</span><span class="p">,</span><span class="o">-</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
    <span class="nf">movl</span>   <span class="kc">$</span><span class="mh">0x0</span><span class="p">,</span><span class="o">-</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
    <span class="nf">lea</span>    <span class="o">-</span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
    <span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>	<span class="c1">; (esp+0xc)=ebp-0x10</span>
    <span class="nf">lea</span>    <span class="o">-</span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
    <span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>	<span class="c1">; (esp+0x8)=ebp-0xc</span>
    <span class="nf">movl</span>   <span class="kc">$</span><span class="mh">0x8049972</span><span class="p">,</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span> <span class="c1">; (esp+0x4)=??</span>

    <span class="nf">mov</span>    <span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
    <span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>
    <span class="nf">call</span>    <span class="o">&lt;</span><span class="nb">ss</span><span class="nv">canf@plt</span><span class="o">&gt;</span>
    <span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">-</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
    <span class="nf">cmpl</span>   <span class="kc">$</span><span class="mh">0x1</span><span class="p">,</span><span class="o">-</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>	<span class="c1">; eax &gt; 1, if not explode!</span>
    <span class="nf">jg</span>      <span class="o">&lt;</span><span class="nv">phase_3</span><span class="o">+</span><span class="mh">0x43</span><span class="o">&gt;</span>
    <span class="nf">call</span>   <span class="o">&lt;</span><span class="nv">explode_bomb</span><span class="o">&gt;</span>
    <span class="nf">mov</span>    <span class="o">-</span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>	<span class="c1">; eax &gt; 7 will explode!</span>
    <span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">-</span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>	<span class="c1">; (ebp-0xc)-&gt;(ebp-0x14)</span>
    <span class="nf">cmpl</span>   <span class="kc">$</span><span class="mh">0x7</span><span class="p">,</span><span class="o">-</span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
    <span class="nf">ja</span>    <span class="o">&lt;</span><span class="nv">phase_3</span><span class="o">+</span><span class="mh">0x95</span><span class="o">&gt;</span> <span class="c1">; jmp to call &lt;explode_bomb&gt;</span>
</code></pre></div></div>

<p>注意到，程序调用了函数 <code class="language-plaintext highlighter-rouge">sscanf</code> 。该函数的意义是，从第一个参数的字符串中读取变量的值。就本次调用而言，函数共准备了四个参数，分别位于<code class="language-plaintext highlighter-rouge">%esp</code>   <code class="language-plaintext highlighter-rouge">%esp+0x4</code> 、 <code class="language-plaintext highlighter-rouge">%esp+0x8</code> 和  <code class="language-plaintext highlighter-rouge">%esp+0xc</code> 。其中，<code class="language-plaintext highlighter-rouge">%esp</code> 就是我们输入的行字符串，这 <code class="language-plaintext highlighter-rouge">0x8049972</code> 表示的是：</p>

<p><img src="/assets/img/CSAPP/lab2/3.png" alt=""></p>

<p>看来是需要输入两个整数。那么，最后的两个参数就一定是输入的整数了，<code class="language-plaintext highlighter-rouge">%esp+0x8</code> 是第一个整数地址，<code class="language-plaintext highlighter-rouge">%esp+0xc</code> 应该是第二个整数地址。<code class="language-plaintext highlighter-rouge">sscanf</code> 函数完成后，读入的两个整数就位于 <code class="language-plaintext highlighter-rouge">ebp-0xc</code> 和 <code class="language-plaintext highlighter-rouge">ebp-0x10</code> 中。</p>

<p>然后对这两个整数做简单判断：要求第一个整数要大于 1 且小于等于 7，否则炸弹会爆炸。接下来，看函数的第二部分：</p>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">;...</span>
    <span class="nf">mov</span>    <span class="o">-</span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">edx</span>		<span class="c1">; edx=(ebp-0x14)</span>
    <span class="nf">mov</span>    <span class="mh">0x8049978</span><span class="p">(,</span><span class="o">%</span><span class="nb">edx</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>	<span class="c1">; eax=(edx*4+0x8049978)</span>
    <span class="nf">jmp</span>    <span class="o">*%</span><span class="nb">eax</span>	<span class="c1">; a switch table</span>
    <span class="nf">addl</span>   <span class="kc">$</span><span class="mh">0x108</span><span class="p">,</span><span class="o">-</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
    <span class="nf">subl</span>   <span class="kc">$</span><span class="mh">0x1e5</span><span class="p">,</span><span class="o">-</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
    <span class="nf">addl</span>   <span class="kc">$</span><span class="mh">0x19a</span><span class="p">,</span><span class="o">-</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
    <span class="nf">subl</span>   <span class="kc">$</span><span class="mh">0x35f</span><span class="p">,</span><span class="o">-</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
    <span class="nf">addl</span>   <span class="kc">$</span><span class="mh">0x239</span><span class="p">,</span><span class="o">-</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
    <span class="nf">subl</span>   <span class="kc">$</span><span class="mh">0x38e</span><span class="p">,</span><span class="o">-</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
    <span class="nf">addl</span>   <span class="kc">$</span><span class="mh">0x38e</span><span class="p">,</span><span class="o">-</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
    <span class="nf">subl</span>   <span class="kc">$</span><span class="mh">0xe3</span><span class="p">,</span><span class="o">-</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
    <span class="nf">jmp</span>     <span class="o">&lt;</span><span class="nv">phase_3</span><span class="o">+</span><span class="mh">0x9a</span><span class="o">&gt;</span>
    <span class="nf">call</span>    <span class="o">&lt;</span><span class="nv">explode_bomb</span><span class="o">&gt;</span>
    <span class="nf">mov</span>    <span class="o">-</span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>	<span class="c1">; eax=(ebp-0xc)</span>
    <span class="nf">cmp</span>    <span class="kc">$</span><span class="mh">0x5</span><span class="p">,</span><span class="o">%</span><span class="nb">eax</span>	<span class="c1">; eax &gt; 5 explode!</span>
    <span class="nf">jg</span>       <span class="o">&lt;</span><span class="nv">phase_3</span><span class="o">+</span><span class="mh">0xaa</span><span class="o">&gt;</span>
    <span class="nf">mov</span>    <span class="o">-</span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>	<span class="c1">; eax=(ebp-0x10)</span>
    <span class="nf">cmp</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">-</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>	<span class="c1">; compare eax with (ebp-0x8)</span>
    <span class="nf">je</span>       <span class="o">&lt;</span><span class="nv">phase_3</span><span class="o">+</span><span class="mh">0xaf</span><span class="o">&gt;</span>
    <span class="nf">call</span>    <span class="o">&lt;</span><span class="nv">explode_bomb</span><span class="o">&gt;</span>
    <span class="nf">leave</span>  
    <span class="nf">ret</span>    
</code></pre></div></div>

<p>第二句汇编又出现了一个奇怪的数字 <code class="language-plaintext highlighter-rouge">0x8049978</code> ，在gdb 调试程序中，打开一看，就会发现其中的奥秘：</p>

<p><img src="/assets/img/CSAPP/lab2/3_1.png" alt=""></p>

<p>在<code class="language-plaintext highlighter-rouge">0x8049978</code> 处，存放了后面 8 条语句的地址！显然，这就是一个跳转表，PC 接下来该指向哪里，完全取决于 <code class="language-plaintext highlighter-rouge">%edx</code> ，也即输入的第一个数字的值。如果第一个数为 2 ，那么程序最终计算 <code class="language-plaintext highlighter-rouge">%ebp-0x8</code> 处的值就是 <code class="language-plaintext highlighter-rouge">0xff91</code> （当然不是计算得到的，通过gdb调试器得出的结果）。于是输入的数值可以为 2 和 -111。</p>

<p>经验证，第三颗炸弹已被拆除，感兴趣的话，也可以尝试一下其他数值。不过注意到，程序最后规定，第一个数字不能大于 5 ！</p>

<p><img src="/assets/img/CSAPP/lab2/3_2.png" alt=""></p>

<h3 id="phase_4">phase_4</h3>

<p>第四颗炸弹：前面和第三颗炸弹一样，调用了 <code class="language-plaintext highlighter-rouge">sscanf</code> 函数。那么这次，<code class="language-plaintext highlighter-rouge">sscanf</code> 函数使用了什么字符串呢？看起来只要输入一个整数就行：</p>

<p><img src="/assets/img/CSAPP/lab2/4.png" alt=""></p>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">phase_4:</span>
    <span class="nf">push</span>   <span class="o">%</span><span class="nb">ebp</span>
    <span class="nf">mov</span>    <span class="o">%</span><span class="nb">esp</span><span class="p">,</span><span class="o">%</span><span class="nb">ebp</span>
    <span class="nf">sub</span>    <span class="kc">$</span><span class="mh">0x28</span><span class="p">,</span><span class="o">%</span><span class="nb">esp</span>
    <span class="nf">lea</span>    <span class="o">-</span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
    <span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>	<span class="c1">; (esp+0x8)=(ebp-0xc)</span>
    <span class="nf">movl</span>   <span class="kc">$</span><span class="mh">0x8049998</span><span class="p">,</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span> <span class="c1">;(esp+0x4)=??</span>
    <span class="nf">mov</span>    <span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
    <span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>
    <span class="nf">call</span>     <span class="o">&lt;</span><span class="nb">ss</span><span class="nv">canf@plt</span><span class="o">&gt;</span>
    <span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">-</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
    <span class="nf">cmpl</span>   <span class="kc">$</span><span class="mh">0x1</span><span class="p">,</span><span class="o">-</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span> <span class="c1">; eax!= 0x1 explode!</span>
    <span class="nf">jne</span>     <span class="o">&lt;</span><span class="nv">phase_4</span><span class="o">+</span><span class="mh">0x30</span><span class="o">&gt;</span>
    <span class="nf">mov</span>    <span class="o">-</span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
    <span class="nf">test</span>   <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">%</span><span class="nb">eax</span>	<span class="c1">; eax=(ebp-0xc)</span>
    <span class="nf">jg</span>      <span class="o">&lt;</span><span class="nv">phase_4</span><span class="o">+</span><span class="mh">0x35</span><span class="o">&gt;</span> <span class="c1">; eax &amp; eax &gt; 0, if not explode!</span>
    <span class="nf">call</span>    <span class="o">&lt;</span><span class="nv">explode_bomb</span><span class="o">&gt;</span>
    <span class="nf">mov</span>    <span class="o">-</span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
    <span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>
    <span class="nf">call</span>     <span class="o">&lt;</span><span class="nv">func4</span><span class="o">&gt;</span>
    <span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">-</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
    <span class="nf">cmpl</span>   <span class="kc">$</span><span class="mh">0x37</span><span class="p">,</span><span class="o">-</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
    <span class="nf">je</span>      <span class="o">&lt;</span><span class="nv">phase_4</span><span class="o">+</span><span class="mh">0x4e</span><span class="o">&gt;</span>	<span class="c1">; 0x37==eax if not explode!</span>
    <span class="nf">call</span>   <span class="o">&lt;</span><span class="nv">explode_bomb</span><span class="o">&gt;</span>
    <span class="nf">leave</span>  
    <span class="nf">ret</span>    
</code></pre></div></div>

<p>经gdb调试后，<code class="language-plaintext highlighter-rouge">%ebp-0xc</code> 是输入的整数，必须大于 0 ，而 <code class="language-plaintext highlighter-rouge">sscanf</code> 函数的返回值必须为 1，否则炸弹会引爆。然后，程序就开始调用 <code class="language-plaintext highlighter-rouge">func4</code> 函数了。注意到，<code class="language-plaintext highlighter-rouge">func4</code> 函数的返回值必须等于 <code class="language-plaintext highlighter-rouge">0x37</code> 否则炸弹会爆炸。那么 <code class="language-plaintext highlighter-rouge">func4</code> 函数是怎么计算的呢？</p>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">func4:</span>
	<span class="nf">push</span>   <span class="o">%</span><span class="nb">ebp</span>
    <span class="nf">mov</span>    <span class="o">%</span><span class="nb">esp</span><span class="p">,</span><span class="o">%</span><span class="nb">ebp</span>
    <span class="nf">push</span>   <span class="o">%</span><span class="nb">ebx</span>
    <span class="nf">sub</span>    <span class="kc">$</span><span class="mh">0x8</span><span class="p">,</span><span class="o">%</span><span class="nb">esp</span>
    <span class="nf">cmpl</span>   <span class="kc">$</span><span class="mh">0x1</span><span class="p">,</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>	<span class="c1">; (ebp+0x8)&gt;0x1?</span>
    <span class="nf">jg</span>       <span class="o">&lt;</span><span class="nv">func4</span><span class="o">+</span><span class="mh">0x16</span><span class="o">&gt;</span>
    <span class="nf">movl</span>   <span class="kc">$</span><span class="mh">0x1</span><span class="p">,</span><span class="o">-</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>	<span class="c1">; (ebp-0x8)=0x1</span>
    <span class="nf">jmp</span>     <span class="o">&lt;</span><span class="nv">func4</span><span class="o">+</span><span class="mh">0x37</span><span class="o">&gt;</span>
    <span class="nf">mov</span>    <span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span> <span class="c1">; eax=(ebp+0x8)</span>
    <span class="nf">dec</span>    <span class="o">%</span><span class="nb">eax</span>
    <span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span> <span class="c1">; esp=eax-1</span>
    <span class="nf">call</span>    <span class="o">&lt;</span><span class="nv">func4</span><span class="o">&gt;</span>
    <span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">%</span><span class="nb">ebx</span>
    <span class="nf">mov</span>    <span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
    <span class="nf">sub</span>    <span class="kc">$</span><span class="mh">0x2</span><span class="p">,</span><span class="o">%</span><span class="nb">eax</span>
    <span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>
    <span class="nf">call</span>   <span class="o">&lt;</span><span class="nv">func4</span><span class="o">&gt;</span>
    <span class="nf">add</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">%</span><span class="nb">ebx</span> <span class="c1">; ebx += eax</span>
    <span class="nf">mov</span>    <span class="o">%</span><span class="nb">ebx</span><span class="p">,</span><span class="o">-</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>	<span class="c1">; (ebp-0x8)=ebx</span>
    <span class="nf">mov</span>    <span class="o">-</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span> <span class="c1">; eax=ebx</span>
    <span class="nf">add</span>    <span class="kc">$</span><span class="mh">0x8</span><span class="p">,</span><span class="o">%</span><span class="nb">esp</span>
    <span class="nf">pop</span>    <span class="o">%</span><span class="nb">ebx</span>
    <span class="nf">pop</span>    <span class="o">%</span><span class="nb">ebp</span>
    <span class="nf">ret</span>    
</code></pre></div></div>

<p>仔细阅读后，整理成如下 C 代码：看起来就是一个斐波那契数列 <img class="emoji" title=":joy:" alt=":joy:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f602.png" height="20" width="20">。结合 <code class="language-plaintext highlighter-rouge">func4</code> 函数的返回值必须是 <code class="language-plaintext highlighter-rouge">0x37</code> ，那么很容易想到，问题是让我们求出，斐波那契数列的哪一项是 <code class="language-plaintext highlighter-rouge">0x37</code> 。</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">func4</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">sum</span> <span class="o">=</span> <span class="n">func4</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">func4</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">sum</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">eax</span><span class="o">=</span><span class="mh">0x1</span>
        <span class="k">return</span> <span class="n">eax</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>嗯，第 9 项，输入 9 就可以拆除炸弹了。</p>

<p><img src="/assets/img/CSAPP/lab2/4_1.png" alt=""></p>

<h3 id="phase_5">phase_5</h3>

<p>与炸弹四一样，phase_5 阶段一开始也调用了 <code class="language-plaintext highlighter-rouge">sscanf</code> 函数，用 gdb 调试，找到要求输入的字符串：需要给出两个整数。</p>

<p><img src="/assets/img/CSAPP/lab2/5.png" alt=""></p>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">phase_5:</span>
	<span class="nf">push</span>   <span class="o">%</span><span class="nb">ebp</span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">esp</span><span class="p">,</span><span class="o">%</span><span class="nb">ebp</span>
	<span class="nf">sub</span>    <span class="kc">$</span><span class="mh">0x38</span><span class="p">,</span><span class="o">%</span><span class="nb">esp</span>
	<span class="nf">lea</span>    <span class="o">-</span><span class="mh">0x18</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>	<span class="c1">; (%esp+0xc)=&amp;%ebp-0x18</span>
	<span class="nf">lea</span>    <span class="o">-</span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>	<span class="c1">; (%esp+0x8)=&amp;%ebp-0x14</span>
	<span class="nf">movl</span>   <span class="kc">$</span><span class="mh">0x8049972</span><span class="p">,</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span> <span class="c1">; (%esp+0x4)=??</span>
	<span class="nf">mov</span>    <span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>
	<span class="nf">call</span>   <span class="mi">8048868</span> <span class="o">&lt;</span><span class="nb">ss</span><span class="nv">canf@plt</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>当输入了两个整数后（已经很熟悉了， <code class="language-plaintext highlighter-rouge">%esp+0x8</code> 和 <code class="language-plaintext highlighter-rouge">%esp+0xc</code> 指向了两个输入整数的地址，而<code class="language-plaintext highlighter-rouge">%ebp-x14</code> 和 <code class="language-plaintext highlighter-rouge">%ebp-0x18</code> 存放了整数值），接下来看看炸弹怎么对这两个整数进行操作。</p>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">mov</span>    <span class="o">-</span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
<span class="nf">and</span>    <span class="kc">$</span><span class="mh">0xf</span><span class="p">,</span><span class="o">%</span><span class="nb">eax</span>
<span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">-</span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>	<span class="c1">;	first int &amp; 0xf, write back</span>
<span class="nf">mov</span>    <span class="o">-</span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
<span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">-</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
<span class="nf">movl</span>   <span class="kc">$</span><span class="mh">0x0</span><span class="p">,</span><span class="o">-</span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
<span class="nf">movl</span>   <span class="kc">$</span><span class="mh">0x0</span><span class="p">,</span><span class="o">-</span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
<span class="nf">jmp</span>    <span class="o">&lt;</span><span class="nv">phase_5</span><span class="o">+</span><span class="mh">0x6a</span><span class="o">&gt;</span>
<span class="nf">incl</span>   <span class="o">-</span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>	<span class="c1">; loop i=(%ebp-0x10)</span>
<span class="nf">mov</span>    <span class="o">-</span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
<span class="nf">mov</span>    <span class="mh">0x804a5c0</span><span class="p">(,</span><span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span> <span class="c1">; 0x804a5c0 ??</span>
<span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">-</span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>  <span class="c1">; write back </span>
<span class="nf">mov</span>    <span class="o">-</span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span> 
<span class="nf">add</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">-</span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span> <span class="c1">; accumulate (%ebp-0xc)</span>
<span class="nf">mov</span>    <span class="o">-</span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span> 
<span class="nf">cmp</span>    <span class="kc">$</span><span class="mh">0xf</span><span class="p">,</span><span class="o">%</span><span class="nb">eax</span>		<span class="c1">;; %eax == 0xf ? ne to loop</span>
<span class="nf">jne</span>    <span class="mi">8048</span><span class="nv">d80</span> <span class="o">&lt;</span><span class="nv">phase_5</span><span class="o">+</span><span class="mh">0x54</span><span class="o">&gt;</span>
<span class="nf">cmpl</span>   <span class="kc">$</span><span class="mh">0xb</span><span class="p">,</span><span class="o">-</span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
<span class="nf">jne</span>    <span class="mi">8048</span><span class="nv">dac</span> <span class="o">&lt;</span><span class="nv">phase_5</span><span class="o">+</span><span class="mh">0x80</span><span class="o">&gt;</span>	<span class="c1">; i must be 0xb, or explode!</span>
<span class="nf">mov</span>    <span class="o">-</span><span class="mh">0x18</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
<span class="nf">cmp</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">-</span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
<span class="nf">je</span>     <span class="mi">8048</span><span class="nv">db1</span> <span class="o">&lt;</span><span class="nv">phase_5</span><span class="o">+</span><span class="mh">0x85</span><span class="o">&gt;</span> <span class="c1">; second int == (%ebp-0xc). or explode!</span>
<span class="nf">call</span>   <span class="mi">8049656</span> <span class="o">&lt;</span><span class="nv">explode_bomb</span><span class="o">&gt;</span>
<span class="nf">leave</span>  
<span class="nf">ret</span>    
</code></pre></div></div>

<p>仔细阅读汇编代码，初步得出结论：输入的第一个整数会作为一个数组的索引，在一个循环中不断累加，得到的累加值会与输入的第二个整数比较。炸弹不爆炸的条件是：循环次数必须为 11 次（0x1-0xb），且第二个整数的值与累加值相等。</p>

<p>首先，来看一下位于 <code class="language-plaintext highlighter-rouge">0x804a5c0</code> 的数组吧：</p>

<p><img src="/assets/img/CSAPP/lab2/5_1.png" alt=""></p>

<p>由于要求循环次数必须为 11 次，而终止循环的条件是 <code class="language-plaintext highlighter-rouge">%eax == 0xf</code> ，也就是说取到数组中的 <code class="language-plaintext highlighter-rouge">0xf</code> 才能结束循环，那我们从后往前推，要取到 <code class="language-plaintext highlighter-rouge">0xf</code> ，必须取到 <code class="language-plaintext highlighter-rouge">0x6</code> （因为 <code class="language-plaintext highlighter-rouge">0xf</code> 的索引是 6），取到 <code class="language-plaintext highlighter-rouge">0x6</code> ，必须先取到 <code class="language-plaintext highlighter-rouge">0xe</code> ……</p>

<p>于是有：0xf -&gt; 0x6 -&gt; 0xe -&gt; 0x2 -&gt; 0x1 -&gt; 0xa -&gt; 0x0 -&gt; 0x8 -&gt; 0x4 -&gt; 0x9 -&gt; 0xd -&gt; 0xb。累加起来值为（不算0xb）82。于是，输入 11 和 82 就可以拆解炸弹。</p>

<p><img src="/assets/img/CSAPP/lab2/5_2.png" alt=""></p>

<h3 id="phase_6">phase_6</h3>

<p>最后一个炸弹，继续前进。注意到，phase_6 先调用了 <code class="language-plaintext highlighter-rouge">atoi</code> 函数，看来是要把某个字符串变为整数。</p>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">phase_6:</span>
	<span class="nf">push</span>   <span class="o">%</span><span class="nb">ebp</span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">esp</span><span class="p">,</span><span class="o">%</span><span class="nb">ebp</span>
	<span class="nf">sub</span>    <span class="kc">$</span><span class="mh">0x18</span><span class="p">,</span><span class="o">%</span><span class="nb">esp</span>
	<span class="nf">movl</span>   <span class="kc">$</span><span class="mh">0x804a66c</span><span class="p">,</span><span class="o">-</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span> <span class="c1">; 0x804a66c ???</span>
	<span class="nf">mov</span>    <span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>	<span class="c1">; %ebp+0x8 ??</span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>
	<span class="nf">call</span>     <span class="o">&lt;</span><span class="nv">atoi@plt</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>首先，还是要用 gdb 调试器看看 <code class="language-plaintext highlighter-rouge">0x804a66c</code> 和传入的参数 <code class="language-plaintext highlighter-rouge">%ebp+0x8</code> 是什么东西。</p>

<p><img src="/assets/img/CSAPP/lab2/6.png" alt=""></p>

<p>得出的信息有点少（主要是看不懂这个字符串），而且 <code class="language-plaintext highlighter-rouge">0x804a66c</code> 处的字符串为空。随后，程序很快就调用了 <code class="language-plaintext highlighter-rouge">fun6</code> 函数：</p>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="nf">call</span>     <span class="o">&lt;</span><span class="nv">atoi@plt</span><span class="o">&gt;</span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">%</span><span class="nb">edx</span>
	<span class="nf">mov</span>    <span class="o">-</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">edx</span><span class="p">,(</span><span class="o">%</span><span class="nb">eax</span><span class="p">)</span>	<span class="c1">; ((%ebp-0x8)) = %edx</span>
	<span class="nf">mov</span>    <span class="o">-</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>	<span class="c1">; %eax as arg</span>
	<span class="nf">call</span>   <span class="mi">8048</span><span class="nv">db3</span> <span class="o">&lt;</span><span class="nv">fun6</span><span class="o">&gt;</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">fun6</code> 函数完成后，会进入一个循环，从下面的汇编代码可以看到，循环中不断重复的一条有效指令就是 <code class="language-plaintext highlighter-rouge">(%ebp-0x4)=((%ebp-0x4)+0x8)</code> 。从这点上看，可以理解为 <code class="language-plaintext highlighter-rouge">(%ebp-0x4)</code> 是一个指针，而这种循环更像是对链表的遍历。后来，根据我的不断尝试，发现该炸弹确实是对一个链表进行操作。</p>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">-</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
	<span class="nf">mov</span>    <span class="o">-</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>	<span class="c1">; fun6 return value is %eax</span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">-</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>  <span class="c1">; (%ebp-0x4)=%eax</span>
	<span class="nf">movl</span>   <span class="kc">$</span><span class="mh">0x1</span><span class="p">,</span><span class="o">-</span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>  <span class="c1">; (%ebp-0xc)=1  i=1</span>
	<span class="nf">jmp</span>    <span class="mi">8048</span><span class="nv">e8f</span> <span class="o">&lt;</span><span class="nv">phase_6</span><span class="o">+</span><span class="mh">0x48</span><span class="o">&gt;</span> <span class="c1">; loop1</span>
	<span class="nf">mov</span>    <span class="o">-</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span> 
	<span class="nf">mov</span>    <span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">eax</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span> 
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">-</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span> <span class="c1">; (%ebp-0x4)=((%ebp-0x4)+0x8)</span>
	<span class="nf">incl</span>   <span class="o">-</span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>	<span class="c1">; i++</span>
	<span class="nf">cmpl</span>   <span class="kc">$</span><span class="mh">0x4</span><span class="p">,</span><span class="o">-</span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
	<span class="nf">jle</span>    <span class="mi">8048</span><span class="nv">e83</span> <span class="o">&lt;</span><span class="nv">phase_6</span><span class="o">+</span><span class="mh">0x3c</span><span class="o">&gt;</span> <span class="c1">; (%ebp-0xc) &lt;= 4 to loop</span>
	<span class="nf">mov</span>    <span class="o">-</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
	<span class="nf">mov</span>    <span class="p">(</span><span class="o">%</span><span class="nb">eax</span><span class="p">),</span><span class="o">%</span><span class="nb">edx</span>	<span class="c1">; %edx=((%ebp-0x4)) =[0x804a60c]</span>
	<span class="nf">mov</span>    <span class="mh">0x804a66c</span><span class="p">,</span><span class="o">%</span><span class="nb">eax</span>
	<span class="nf">cmp</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">%</span><span class="nb">edx</span>	<span class="c1">; %edx == 0x804a66c ??</span>
	<span class="nf">je</span>     <span class="mi">8048</span><span class="nv">ea8</span> <span class="o">&lt;</span><span class="nv">phase_6</span><span class="o">+</span><span class="mh">0x61</span><span class="o">&gt;</span> <span class="c1">; if not eq, explode!</span>
	<span class="nf">call</span>   <span class="mi">8049656</span> <span class="o">&lt;</span><span class="nv">explode_bomb</span><span class="o">&gt;</span>
	<span class="nf">leave</span>  
	<span class="nf">ret</span>    
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">fun6</code> 函数非常复杂，但仔细观察发现，该函数运行后产生的结果与我们给的输入无关。那么就有一个技巧，可以用gdb调试器在 <code class="language-plaintext highlighter-rouge">fun6</code> 函数返回后设置断点，观察其返回值 <code class="language-plaintext highlighter-rouge">%eax==0x804a618</code> 。然后，上述汇编代码的循环会执行 5 次，我使用 gdb 调试器将整个链表的值都打印在下图中。<code class="language-plaintext highlighter-rouge">0x804a618</code> 对应的是 node7，而上面汇编代码中，要求 <code class="language-plaintext highlighter-rouge">%edx==[0x804a66c]</code> ，其对应的是 node0，经过多次实验，我发现，node0 为用户输入的值（见下图，输入 5 时）。</p>

<p><img src="/assets/img/CSAPP/lab2/6_1.png" alt=""></p>

<p>那么问题来了，应该输入什么才能拆解炸弹呢？顺着程序过一遍，一开始 <code class="language-plaintext highlighter-rouge">%eax=0x804a618</code>，指向了 node7，然后根据 <code class="language-plaintext highlighter-rouge">(%ebp-0x4)=((%ebp-0x4)+0x8)</code> ，链接到下一个节点，一共执行 5 次，先后是 node3、node5、node9、node8 ，遍历后， <code class="language-plaintext highlighter-rouge">%ebp-0x4</code>中的值应该为 <code class="language-plaintext highlighter-rouge">0x804a60c</code>（见下图），当从中取出的值也为 <code class="language-plaintext highlighter-rouge">0x20e</code> 时，才能拆解炸弹。</p>

<p><img src="/assets/img/CSAPP/lab2/6_3.png" alt=""></p>

<p>如下图，已经成功拆解完 6 个炸弹。</p>

<p><img src="/assets/img/CSAPP/lab2/6_2.png" alt=""></p>

<h3 id="secret_phase">secret_phase</h3>

<p>一切还没结束，从汇编代码看，我们还剩一个隐藏炸弹没有拆解掉。首先，我们需要找到隐藏炸弹的输入入口。否则，gdb 调试器是帮不了我们的。全局搜索一下，发现在 <code class="language-plaintext highlighter-rouge">phase_defused</code> 函数下找到了 <code class="language-plaintext highlighter-rouge">call secret_phase</code> 语句。</p>

<p>经分析，确认是要在拆解完所有炸弹后，才有机会见到这枚隐藏炸弹。而如何输入密语也是非常考验我们的水平的！因此，先要细细研究 <code class="language-plaintext highlighter-rouge">phase_defused</code> 函数：</p>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">phase_defused:</span>
	<span class="c1">;  ...</span>
	<span class="nf">jne</span>    <span class="mi">80496</span><span class="nv">fe</span> <span class="o">&lt;</span><span class="nv">phase_defused</span><span class="o">+</span><span class="mh">0x7e</span><span class="o">&gt;</span>
	<span class="nf">mov</span>    <span class="kc">$</span><span class="mh">0x804a990</span><span class="p">,</span><span class="o">%</span><span class="nb">eax</span> 	<span class="c1">; 0x804a990 ???</span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">%</span><span class="nb">edx</span>
	<span class="nf">lea</span>    <span class="o">-</span><span class="mh">0x54</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>	<span class="c1">; arg : (%ebp-0x54)</span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>
	<span class="nf">lea</span>    <span class="o">-</span><span class="mh">0x58</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>	<span class="c1">; arg : (%ebp-0x58)</span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>
	<span class="nf">movl</span>   <span class="kc">$</span><span class="mh">0x8049e38</span><span class="p">,</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span> <span class="c1">; 0x8049e38 ??</span>
 
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">edx</span><span class="p">,(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>
	<span class="nf">call</span>   <span class="mi">8048868</span> <span class="o">&lt;</span><span class="nb">ss</span><span class="nv">canf@plt</span><span class="o">&gt;</span> <span class="c1">; sscanf</span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">-</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
	<span class="nf">cmpl</span>   <span class="kc">$</span><span class="mh">0x2</span><span class="p">,</span><span class="o">-</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
	<span class="nf">jne</span>    <span class="mi">80496</span><span class="nv">f2</span> <span class="o">&lt;</span><span class="nv">phase_defused</span><span class="o">+</span><span class="mh">0x72</span><span class="o">&gt;</span>
	<span class="nf">movl</span>   <span class="kc">$</span><span class="mh">0x8049e3e</span><span class="p">,</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>	<span class="c1">; 0x8049e3e ??</span>
 
	<span class="nf">lea</span>    <span class="o">-</span><span class="mh">0x54</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>
	<span class="nf">call</span>   <span class="mi">804908</span><span class="nv">f</span> <span class="o">&lt;</span><span class="nv">strings_not_equal</span><span class="o">&gt;</span>
	<span class="nf">test</span>   <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">%</span><span class="nb">eax</span>	<span class="c1">; to see if string is equal</span>
	<span class="nf">jne</span>    <span class="mi">80496</span><span class="nv">f2</span> <span class="o">&lt;</span><span class="nv">phase_defused</span><span class="o">+</span><span class="mh">0x72</span><span class="o">&gt;</span>
	<span class="c1">; ...</span>
</code></pre></div></div>

<p>重点是 <code class="language-plaintext highlighter-rouge">sscanf</code> 函数及其参数，第一个参数是 <code class="language-plaintext highlighter-rouge">%edx</code> ，指向 <code class="language-plaintext highlighter-rouge">0x804a990</code> ，第二个参数是 <code class="language-plaintext highlighter-rouge">0x8049e38</code>，其实是一个字符串（见下图）， 第三个参数和第四个参数分别是 <code class="language-plaintext highlighter-rouge">%ebp-0x58</code> 和 <code class="language-plaintext highlighter-rouge">%ebp-0x54</code> 。从后半部分代码看出，要求输入的字符串必须是 austinpowers，且 <code class="language-plaintext highlighter-rouge">sscanf</code> 函数返回值为 2，意思是整数和字符串必须都有对应的输入。</p>

<p><img src="/assets/img/CSAPP/lab2/secret.png" alt=""></p>

<p><img src="/assets/img/CSAPP/lab2/s_1.png" alt=""></p>

<p>再来看看 <code class="language-plaintext highlighter-rouge">0x804a990</code> （见下图），很奇怪的是，它只有一个 “9”，这样的话，<code class="language-plaintext highlighter-rouge">sscanf</code> 函数的返回值就只能是 1 了，我们就没法打开隐藏关卡了。还有，这个 <code class="language-plaintext highlighter-rouge">&lt;input_string&gt;</code> 是什么？</p>

<p><img src="/assets/img/CSAPP/lab2/s_2.png" alt=""></p>

<p>看起来，要先解决 <code class="language-plaintext highlighter-rouge">&lt;input_string&gt;</code> 的问题，不过，一切来的很轻松（见下图）。看来，我们之前拆炸弹的每一个输入都以 80 字节对齐的方式存放于此！这样看来，就是要在第 4 个炸弹拆解时，后面加上字符串 austinpowers， 就可以发现隐藏炸弹了！</p>

<p><img src="/assets/img/CSAPP/lab2/s_3.png" alt=""></p>

<p>终于，我们来到了隐藏炸弹，现在看看这一炸弹的具体代码。</p>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">secret_phase:</span>
	<span class="nf">push</span>   <span class="o">%</span><span class="nb">ebp</span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">esp</span><span class="p">,</span><span class="o">%</span><span class="nb">ebp</span>
	<span class="nf">sub</span>    <span class="kc">$</span><span class="mh">0x18</span><span class="p">,</span><span class="o">%</span><span class="nb">esp</span>
	<span class="nf">call</span>    <span class="o">&lt;</span><span class="nv">read_line</span><span class="o">&gt;</span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">-</span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
	<span class="nf">mov</span>    <span class="o">-</span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>
	<span class="nf">call</span>    <span class="o">&lt;</span><span class="nv">atoi@plt</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>看起来，需要读入一行，并且读入的这一行会使用 <code class="language-plaintext highlighter-rouge">atoi</code> 函数转为数字。要求数字必须为正数，且小于 <code class="language-plaintext highlighter-rouge">0x3e9</code> 。</p>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">-</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
	<span class="nf">cmpl</span>   <span class="kc">$</span><span class="mh">0x0</span><span class="p">,</span><span class="o">-</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
	<span class="nf">jle</span>     <span class="o">&lt;</span><span class="nv">secret_phase</span><span class="o">+</span><span class="mh">0x2b</span><span class="o">&gt;</span>	 <span class="c1">; %eax &lt;= 0 explode</span>
	<span class="nf">cmpl</span>   <span class="kc">$</span><span class="mh">0x3e9</span><span class="p">,</span><span class="o">-</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
	<span class="nf">jle</span>    <span class="o">&lt;</span><span class="nv">secret_phase</span><span class="o">+</span><span class="mh">0x30</span><span class="o">&gt;</span> <span class="c1">; %eax &lt;= 0x3e9 </span>
	<span class="nf">call</span>   <span class="mi">8049656</span> <span class="o">&lt;</span><span class="nv">explode_bomb</span><span class="o">&gt;</span>
	<span class="nf">mov</span>    <span class="o">-</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>	<span class="c1">; (%esp+0x4)=int</span>
	<span class="nf">movl</span>   <span class="kc">$</span><span class="mh">0x804a720</span><span class="p">,(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span> <span class="c1">; 0x804a720 ???</span>
	<span class="nf">call</span>   <span class="mi">8048</span><span class="nv">eaa</span> <span class="o">&lt;</span><span class="nv">fun7</span><span class="o">&gt;</span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">-</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span> <span class="c1">; return val=eax</span>
	<span class="nf">cmpl</span>   <span class="kc">$</span><span class="mh">0x3</span><span class="p">,</span><span class="o">-</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>	<span class="c1">; %eax==0x3, or explode </span>
	<span class="nf">je</span>      <span class="o">&lt;</span><span class="nv">secret_phase</span><span class="o">+</span><span class="mh">0x51</span><span class="o">&gt;</span>
	<span class="nf">call</span>    <span class="o">&lt;</span><span class="nv">explode_bomb</span><span class="o">&gt;</span>
	<span class="nf">movl</span>   <span class="kc">$</span><span class="mh">0x804999c</span><span class="p">,(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>
	<span class="nf">call</span>   <span class="mi">80487</span><span class="nv">c8</span> <span class="o">&lt;</span><span class="nv">puts@plt</span><span class="o">&gt;</span>
	<span class="nf">call</span>   <span class="mi">8049680</span> <span class="o">&lt;</span><span class="nv">phase_defused</span><span class="o">&gt;</span>
	<span class="nf">leave</span>  
	<span class="nf">ret</span>    
</code></pre></div></div>

<p>重点是 <code class="language-plaintext highlighter-rouge">fun7</code> 函数，其参数有两个，一个是我们输入的数字，另一个是立即数 <code class="language-plaintext highlighter-rouge">0x804a720</code>，这个立即数不应当是一个“数字”，更有可能是一个指针。由上面的代码可知，返回值应该为3，否则就会爆炸。接下来，仔细研究一下 <code class="language-plaintext highlighter-rouge">fun7</code> 的代码。</p>

<div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">fun7:</span>
	<span class="nf">push</span>   <span class="o">%</span><span class="nb">ebp</span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">esp</span><span class="p">,</span><span class="o">%</span><span class="nb">ebp</span>
	<span class="nf">sub</span>    <span class="kc">$</span><span class="mh">0xc</span><span class="p">,</span><span class="o">%</span><span class="nb">esp</span>
	<span class="nf">cmpl</span>   <span class="kc">$</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>	<span class="c1">; (%ebp+0x8)=0x804a720</span>
	<span class="nf">jne</span>     <span class="o">&lt;</span><span class="nv">fun7</span><span class="o">+</span><span class="mh">0x15</span><span class="o">&gt;</span>
	<span class="nf">movl</span>   <span class="kc">$</span><span class="mh">0xffffffff</span><span class="p">,</span><span class="o">-</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>	<span class="c1">; low 2 word is 0 then (%ebp-0x4)=-1</span>
	<span class="nf">jmp</span>    <span class="mi">8048</span><span class="nv">f13</span> <span class="o">&lt;</span><span class="nv">fun7</span><span class="o">+</span><span class="mh">0x69</span><span class="o">&gt;</span>
	<span class="nf">mov</span>    <span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>	
	<span class="nf">mov</span>    <span class="p">(</span><span class="o">%</span><span class="nb">eax</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
	<span class="nf">cmp</span>    <span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>	<span class="c1">; %eax=((%ebp+0x8)) &lt;= (%ebp+0xc)</span>
	<span class="nf">jle</span>      <span class="o">&lt;</span><span class="nv">fun7</span><span class="o">+</span><span class="mh">0x3b</span><span class="o">&gt;</span>
	<span class="nf">mov</span>    <span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
	<span class="nf">mov</span>    <span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">eax</span><span class="p">),</span><span class="o">%</span><span class="nb">edx</span>	<span class="c1">; %edx = ((%ebp+0x8)+0x4)</span>
	<span class="nf">mov</span>    <span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>	<span class="c1">; (%esp+0x4)=(%ebp+0xc)</span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">edx</span><span class="p">,(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>
	<span class="nf">call</span>   <span class="mi">8048</span><span class="nv">eaa</span> <span class="o">&lt;</span><span class="nv">fun7</span><span class="o">&gt;</span>
	<span class="nf">add</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">%</span><span class="nb">eax</span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">-</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
	<span class="nf">jmp</span>    <span class="mi">8048</span><span class="nv">f13</span> <span class="o">&lt;</span><span class="nv">fun7</span><span class="o">+</span><span class="mh">0x69</span><span class="o">&gt;</span>
	<span class="nf">mov</span>    <span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>	<span class="c1">; </span>
	<span class="nf">mov</span>    <span class="p">(</span><span class="o">%</span><span class="nb">eax</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
	<span class="nf">cmp</span>    <span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>	<span class="c1">; %eax=((%ebp+0x8)) != (%ebp+0xc)</span>
	<span class="nf">jne</span>    <span class="mi">8048</span><span class="nv">ef8</span> <span class="o">&lt;</span><span class="nv">fun7</span><span class="o">+</span><span class="mh">0x4e</span><span class="o">&gt;</span>
	<span class="nf">movl</span>   <span class="kc">$</span><span class="mh">0x0</span><span class="p">,</span><span class="o">-</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
	<span class="nf">jmp</span>    <span class="mi">8048</span><span class="nv">f13</span> <span class="o">&lt;</span><span class="nv">fun7</span><span class="o">+</span><span class="mh">0x69</span><span class="o">&gt;</span>
	<span class="nf">mov</span>    <span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
	<span class="nf">mov</span>    <span class="mh">0x8</span><span class="p">(</span><span class="o">%</span><span class="nb">eax</span><span class="p">),</span><span class="o">%</span><span class="nb">edx</span>	<span class="c1">; %edx = ((%ebp+0x8)+0x8)</span>
	<span class="nf">mov</span>    <span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>	<span class="c1">; </span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>	<span class="c1">; (%esp+0x4)=(%ebp+0xc)</span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">edx</span><span class="p">,(</span><span class="o">%</span><span class="nb">esp</span><span class="p">)</span>
	<span class="nf">call</span>   <span class="mi">8048</span><span class="nv">eaa</span> <span class="o">&lt;</span><span class="nv">fun7</span><span class="o">&gt;</span> <span class="c1">; call fun7</span>
	<span class="nf">add</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">%</span><span class="nb">eax</span>
	<span class="nf">inc</span>    <span class="o">%</span><span class="nb">eax</span>
	<span class="nf">mov</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="o">-</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">)</span>
	<span class="nf">mov</span>    <span class="o">-</span><span class="mh">0x4</span><span class="p">(</span><span class="o">%</span><span class="nb">ebp</span><span class="p">),</span><span class="o">%</span><span class="nb">eax</span>
	<span class="nf">leave</span>  
	<span class="nf">ret</span>    
</code></pre></div></div>

<p>转化为 C 代码，可能比较方便理解，可见，还是递归函数。</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">fun7</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">a</span> <span class="o">&amp;</span> <span class="mh">0x0ffff</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">a</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">a</span> <span class="o">!=</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">a</span><span class="o">+=</span><span class="mi">8</span> <span class="n">byte</span><span class="p">;</span>
                <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">fun7</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
                <span class="n">ret</span> <span class="o">+=</span> <span class="n">ret</span><span class="p">;</span>		<span class="n">ret</span><span class="o">++</span><span class="p">;</span>
                <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span>
                <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">a</span><span class="o">+=</span><span class="mi">4</span> <span class="n">byte</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">fun7</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="n">ret</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>现在，需要让 <code class="language-plaintext highlighter-rouge">fun7</code> 函数返回值为3，应当如何设置a 和 b 的值呢？不难想到，返回值为3，要求最内部的函数返回值为0，然后再返回1，再返回3，但首先，需要知道 <code class="language-plaintext highlighter-rouge">0x804a720</code>的值。经过多次尝试，求出如下数据：</p>

<p><img src="/assets/img/CSAPP/lab2/6_4.png" alt=""></p>

<p>根据之前的推算，需要调用三层 <code class="language-plaintext highlighter-rouge">fun7</code> 函数，第一次需走入 <code class="language-plaintext highlighter-rouge">*a&lt;b</code> 的分支，第二次也是，第三次需要走入 <code class="language-plaintext highlighter-rouge">*a==b</code> 的分支，这样返回的值才能为3。倒推回去，第一次指针为 <code class="language-plaintext highlighter-rouge">0x804a720</code> ，第二次需要 +8，指针地址为 <code class="language-plaintext highlighter-rouge">0x804a708</code> ，然后再加8，为 <code class="language-plaintext highlighter-rouge">0x804a6d8</code> ，此时指针指向的值是 <code class="language-plaintext highlighter-rouge">0x6b</code> 。要求输入的值与 <code class="language-plaintext highlighter-rouge">0x6b</code> 相等，才能返回3，因此，拆解该炸弹的答案是 107。</p>

<p>最后的最后，解答成功！</p>

<p><img src="/assets/img/CSAPP/lab2/final.png" alt=""></p>

<h2 id="总结">总结</h2>

<p>回头看这几颗炸弹的拆解过程，每颗炸弹难度递增，考点不一但都极具代表性。第一阶段考察了字符串比较，需要我们熟练使用 gdb 调试器。第二阶段考察了汇编语言的循环部分，能否理解循环非常关键。第三阶段考察了汇编语言的 <code class="language-plaintext highlighter-rouge">switch</code> 语句的实现。第四阶段考察了递归函数调用，第五阶段考察了数组索引以及循环结构，第六阶段则是关于链表的遍历。最后的秘密阶段更是融合了多个考点，做完之后很有成就感！</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> tag: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#binarybombs" class="page__taxonomy-item" rel="tag">BinaryBombs</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#csapp" class="page__taxonomy-item" rel="tag">CSAPP</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#x86" class="page__taxonomy-item" rel="tag">x86</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> category: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#csapp" class="page__taxonomy-item" rel="tag">CSAPP</a>
    
    </span>
  </p>


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> update time:</strong> <time datetime="2021-05-26T00:00:00+08:00">May 26, 2021</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">share</h4>
  

  <a href="https://twitter.com/intent/tweet?text=%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E4%B9%8B%E4%BA%8C%E8%BF%9B%E5%88%B6%E7%82%B8%E5%BC%B9%E5%AE%9E%E9%AA%8C%20https%3A%2F%2Fdingfen.github.io%2Fcsapp%2F2021%2F05%2F26%2FCSAPPLab02.html" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="share Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fdingfen.github.io%2Fcsapp%2F2021%2F05%2F26%2FCSAPPLab02.html" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="share Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fdingfen.github.io%2Fcsapp%2F2021%2F05%2F26%2FCSAPPLab02.html" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="share LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/csapp/2021/04/30/CSAPPLab01.html" class="pagination--pager" title="深入理解计算机系统之位操作实验
">previous</a>
    
    
      <a href="/csapp/2021/05/27/CSAPPLab03.html" class="pagination--pager" title="深入理解计算机系统之缓冲区溢出炸弹实验
">next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">related</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/img/teaser.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/cpp/2022/03/13/gem5-3.html" rel="permalink">深入理解 Gem5 之三
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  1 minutes read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">关于gem5中SimObject类
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/img/teaser.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/cpp/2022/03/08/gem5-2.html" rel="permalink">深入理解 Gem5 之二
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  6 minutes read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">关于gem5中序列化等实现
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/img/teaser.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/cpp/2022/02/24/gem5-1.html" rel="permalink">深入理解 Gem5 之一
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  7 minutes read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">关于gem5事件的实现
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/img/teaser.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/cpp/2021/11/15/Qt-signal-slot.html" rel="permalink">信号槽机制的简陋实现
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  4 minutes read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap">
<form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="输入您要搜索的关键词...">
  </form>
  <div id="results" class="results"></div>
</div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>follow:</strong></li>
    

    
      
        
          <li><a href="https://github.com/dingfen" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> Github</a></li>
        
      
        
          <li><a href="df12138@mail.ustc.edu.cn" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">© 2022 Bill Ding. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




    
  <script>
    var disqus_config = function () {
      this.page.url = "https://dingfen.github.io/csapp/2021/05/26/CSAPPLab02.html";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/csapp/2021/05/26/CSAPPLab02"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://https://dingfen.github.io/.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>


  





  </body>
</html>
